\section{Appendices}\label{sec:app:app}

\subsection{Description of simulation, synthesis and hardware tests}\label{sec:app:app_e}

Workflow for simulation and synthesis of firmware is described in \href{\gitbranch/README.md}{\texttt{README}} file.\\\\
List of useful TDF routines and commands for hardware tests:
\begin{itemize}
\item Check crate status\\
\greybox{\$ tdf run crate\_status}
\item Enable TTC signals on AMC13 for all MP7 modules\\
\greybox{\$ tdf run ttc\_enable}
\item Check lock of BC0 and LHC clock\\
\greybox{\$ tdf unittest <module> default}
\item Reset module\\
\greybox{\$ tdf mp7butler reset <module> --clksrc external --clkcfg default-ext}
\item Load firmware to scansd card on all MP7 modules [and load it into FPGAs]\\
\greybox{\$ tdf run uploadfw\_gt <tar file path> [--rebootfpga]}
\item Load firmware from scansd card into FPGAs\\
\greybox{\$ tdf run loadfw\_gt <fw build nr> <nr modules>}
\item Compare hardware results with test vector pattern (for a certain firmware build)\\
\greybox{\$ tdf run multiboard\_function\_test -h}
\item Setup links (GTHs)\\
\greybox{\$ tdf mp7butler rxmgts <module> -e <links>}
\item Align links (GTHs)\\
\greybox{\$ tdf mp7butler rxalign <module> -e <links> [--to-bx <alignment point>]}
\item Check minipods\\
\greybox{\$ tdf mp7butler minipods <module>}
\item ... (other routines are available in /nfshome0/ugtdev/software/tdf/etc/routines)
\end{itemize}

\clearpage
\subsection{GTH I/Os}\label{sec:app:gth_io}

\textbf{Remark}:
Connections of RX2 and TX2 must be checked and confirmed!!!

\subsubsection{GTH input connections}\label{sec:app:gth_i_conn}

The following Table contains the GTH input connections from MP7 MTP front connectors\footnote{"ch." means "channel", "pp" means "optical patch panel connector number"}:

\begin{longtable}{|l|c|c|c|c|c|c|c|l|}
\hline
\textbf{MTP48}& \textbf{minipod}& \textbf{quad}& \textbf{GTH ch.}& \textbf{GTH}& \textbf{MP7 ch.} &\textbf{pp}& \textbf{lane}& \textbf{data}\\
\hline
\hline
\endhead
RX1/1  & rx3/0  & 118 & X1Y35 & 10G & 0x00 & 1  & 0  & muon\\\hline
RX1/2  & rx3/1  &     & X1Y34 & 10G & 0x02 & 2  & 1  & muon\\\hline
RX1/3  & rx3/2  &     & X1Y33 & 10G & 0x04 & 3  & 2  & muon\\\hline
RX1/4  & rx3/3  &     & X1Y32 & 10G & 0x06 & 4  & 3  & muon\\\hline
RX1/5  & rx3/4  & 117 & X1Y31 & 10G & 0x08 & 5  & 4  & eg\\\hline
RX1/6  & rx3/5  &     & X1Y30 & 10G & 0x0A & 6  & 5  & eg\\\hline
RX1/7  & rx3/6  &     & X1Y29 & 10G & 0x0C & 7  & 6  & jet\\\hline
RX1/8  & rx3/7  &     & X1Y28 & 10G & 0x0E & 8  & 7  & jet\\\hline
RX1/9  & rx3/8  & 116 & X1Y27 & 10G & 0x10 & 9  & 8  & tau\\\hline
RX1/10 & rx3/9  &     & X1Y26 & 10G & 0x12 & 10 & 9  & tau\\\hline
RX1/11 & rx3/10 &     & X1Y25 & 10G & 0x14 & 11 & 10 & esums\\\hline
RX1/12 & rx3/11 &     & X1Y24 & 10G & 0x16 & 12 & 11 & free\\\hline
RX1/13 & rx4/0  & 115 & X1Y23 & 10G & 0x18 & 13 & 12 & external conditions\\\hline
RX1/14 & rx4/1  &     & X1Y22 & 10G & 0x1A & 14 & 13 & external conditions\\\hline
RX1/15 & rx4/2  &     & X1Y21 & 10G & 0x1C & 15 & 14 & external conditions\\\hline
RX1/16 & rx4/3  &     & X1Y20 & 10G & 0x1E & 16 & 15 & external conditions\\\hline
RX1/17 & rx4/4  & 114 & X1Y19 & 10G & 0x20 & 17 & 16 & free\\\hline
RX1/18 & rx4/5  &     & X1Y18 & 10G & 0x22 & 18 & 17 & free\\\hline
RX1/19 & rx4/6  &     & X1Y17 & 10G & 0x24 & 19 & 18 & free\\\hline
RX1/20 & rx4/7  &     & X1Y16 & 10G & 0x26 & 20 & 19 & free\\\hline
RX1/21 & rx4/8  & 113 & X1Y15 & 10G & 0x28 & 21 & 20 & free\\\hline
RX1/22 & rx4/9  &     & X1Y14 & 10G & 0x2A & 22 & 21 & free\\\hline
RX1/23 & rx4/10 &     & X1Y13 & 10G & 0x2C & 23 & 22 & free\\\hline
RX1/24 & rx4/11 &     & X1Y12 & 10G & 0x2E & 24 & 23 & free\\\hline
RX1/25 & rx5/0  & 112 & X1Y11 & 10G & 0x30 & nc & 24 & -\\\hline
RX1/28 & rx5/3  &     & X1Y10 & 10G & 0x32 & nc & 25 & -\\\hline
RX1/26 & rx5/1  &     & X1Y09 & 10G & 0x34 & nc & 26 & -\\\hline
RX1/27 & rx5/2  &     & X1Y08 & 10G & 0x36 & nc & 27 & -\\\hline
RX1/30 & rx5/5  & 111 & X1Y07 &  x  & 0x38 & nc & 28 & -\\\hline
RX1/29 & rx5/4  &     & X1Y06 &  x  & 0x3A & nc & 29 & -\\\hline
RX1/31 & rx5/6  &     & X1Y05 &  x  & 0x3C & nc & 30 & -\\\hline
RX1/32 & rx5/7  &     & X1Y04 &  x  & 0x3E & nc & 31 & -\\\hline
RX1/33 & rx5/8  & 110 & X1Y03 &  x  & 0x40 & nc & 32 & -\\\hline
RX1/34 & rx5/9  &     & X1Y02 &  x  & 0x42 & nc & 33 & -\\\hline
RX1/35 & rx5/10 &     & X1Y01 &  x  & 0x44 & nc & 34 & -\\\hline
RX1/36 & rx5/11 &     & X1Y00 &  x  & 0x46 & nc & 35 & -\\\hline
RX2/26 & rx2/1  &     & X0Y00 &  x  & 0x48 & nc & 36 & -\\\hline
RX2/25 & rx2/0  &     & X0Y01 &  x  & 0x4A & nc & 37 & -\\\hline
RX2/28 & rx2/3  &     & X0Y02 &  x  & 0x4C & nc & 38 & -\\\hline
RX2/27 & rx2/2  & 210 & X0Y03 &  x  & 0x4E & nc & 39 & -\\\hline
RX2/30 & rx2/5  &     & X0Y04 &  x  & 0x50 & nc & 40 & -\\\hline
RX2/29 & rx2/4  &     & X0Y05 &  x  & 0x52 & nc & 41 & -\\\hline
RX2/31 & rx2/7  &     & X0Y06 &  x  & 0x54 & nc & 42 & -\\\hline
RX2/32 & rx2/6  & 211 & X0Y07 &  x  & 0x56 & nc & 43 & -\\\hline
RX2/33 & rx2/8  &     & X0Y08 &  x  & 0x58 & nc & 44 & -\\\hline
RX2/35 & rx2/10 &     & X0Y09 &  x  & 0x5A & nc & 45 & -\\\hline
RX2/34 & rx2/9  &     & X0Y10 &  x  & 0x5C & nc & 46 & -\\\hline
RX2/36 & rx2/11 & 212 & X0Y11 &  x  & 0x5E & nc & 47 & -\\\hline
RX2/14 & rx1/1  &     & X0Y12 &  x  & 0x60 & nc & 48 & -\\\hline
RX2/13 & rx1/0  &     & X0Y13 &  x  & 0x62 & nc & 49 & -\\\hline
RX2/16 & rx1/3  &     & X0Y14 &  x  & 0x64 & nc & 50 & -\\\hline
RX2/15 & rx1/2  & 213 & X0Y15 &  x  & 0x66 & nc & 51 & -\\\hline
RX2/18 & rx1/5  &     & X0Y16 &  x  & 0x68 & nc & 52 & -\\\hline
RX2/17 & rx1/4  &     & X0Y17 &  x  & 0x6A & nc & 53 & -\\\hline
RX2/20 & rx1/7  &     & X0Y18 &  x  & 0x6C & nc & 54 & -\\\hline
RX2/19 & rx1/6  & 214 & X0Y19 &  x  & 0x6E & nc & 55 & -\\\hline
RX2/22 & rx1/9  &     & X0Y20 &  x  & 0x70 & nc & 56 & -\\\hline
RX2/21 & rx1/8  &     & X0Y21 &  x  & 0x72 & nc & 57 & -\\\hline
RX2/23 & rx1/10 &     & X0Y22 &  x  & 0x74 & nc & 58 & -\\\hline
RX2/24 & rx1/11 & 215 & X0Y23 &  x  & 0x76 & nc & 59 & -\\\hline
RX2/2  & rx0/1  &     & X0Y24 & 10G & 0x78 & nc & 60 & -\\\hline
RX2/1  & rx0/0  &     & X0Y25 & 10G & 0x7A & nc & 61 & -\\\hline
RX2/4  & rx0/3  &     & X0Y26 & 10G & 0x7C & nc & 62 & -\\\hline
RX2/3  & rx0/2  & 216 & X0Y27 & 10G & 0x7E & nc & 63 & -\\\hline
RX2/6  & rx0/5  &     & X0Y28 & 10G & 0x80 & nc & 64 & -\\\hline
RX2/5  & rx0/4  &     & X0Y29 & 10G & 0x82 & nc & 65 & -\\\hline
RX2/8  & rx0/7  &     & X0Y30 & 10G & 0x84 & nc & 66 & -\\\hline
RX2/7  & rx0/6  & 217 & X0Y31 & 10G & 0x86 & nc & 67 & -\\\hline
RX2/10 & rx0/9  &     & X0Y32 &  5G & 0x88 & nc & 68 & -\\\hline
RX2/9  & rx0/8  &     & X0Y33 &  5G & 0x8A & nc & 69 & -\\\hline
RX2/11 & rx0/10 &     & X0Y34 &  5G & 0x8C & nc & 70 & -\\\hline
RX2/12 & rx0/11 & 218 & X0Y35 &  5G & 0x8E & nc & 71 & ZDC 5G input\\\hline
\end{longtable}

\subsubsection{GTH output connections}\label{sec:app:gth_o_conn}

The following Table contains the GTH output connections to MP7 MTP front connectors:

\begin{longtable}{|l|c|c|c|c|c|c|c|l|}
\hline
\textbf{MTP48}& \textbf{minipod}& \textbf{quad}& \textbf{GTH ch.}& \textbf{GTH}& \textbf{MP7 ch.} &\textbf{pp}& \textbf{lane}& \textbf{data}\\
\hline
\hline
\endhead
TX1/1  & tx3/0  & 118 & X1Y35 & 10G & 0x01 & nc & 0  & -\\\hline
TX1/2  & tx3/1  &     & X1Y34 & 10G & 0x03 & nc & 1  & -\\\hline
TX1/3  & tx3/2  &     & X1Y33 & 10G & 0x05 & nc & 2  & -\\\hline
TX1/4  & tx3/3  &     & X1Y32 & 10G & 0x07 & nc & 3  & -\\\hline
TX1/5  & tx3/4  & 117 & X1Y31 & 10G & 0x09 & nc & 4  & -\\\hline
TX1/6  & tx3/5  &     & X1Y30 & 10G & 0x0b & nc & 5  & -\\\hline
TX1/7  & tx3/6  &     & X1Y29 & 10G & 0x0d & nc & 6  & -\\\hline
TX1/8  & tx3/7  &     & X1Y28 & 10G & 0x0f & nc & 7  & -\\\hline
TX1/9  & tx3/8  & 116 & X1Y27 & 10G & 0x11 & nc & 8  & -\\\hline
TX1/10 & tx3/9  &     & X1Y26 & 10G & 0x13 & nc & 9  & -\\\hline
TX1/11 & tx3/10 &     & X1Y25 & 10G & 0x15 & nc & 10 & -\\\hline
TX1/12 & tx3/11 &     & X1Y24 & 10G & 0x17 & nc & 11 & -\\\hline
TX1/13 & tx4/0  & 115 & X1Y23 & 10G & 0x19 & nc & 12 & -\\\hline
TX1/14 & tx4/1  &     & X1Y22 & 10G & 0x1b & nc & 13 & -\\\hline
TX1/15 & tx4/2  &     & X1Y21 & 10G & 0x1d & nc & 14 & -\\\hline
TX1/16 & tx4/3  &     & X1Y20 & 10G & 0x1f & nc & 15 & -\\\hline
TX1/17 & tx4/4  & 114 & X1Y19 & 10G & 0x21 & nc & 16 & readout (AMC13)\\\hline
TX1/18 & tx4/5  &     & X1Y18 & 10G & 0x23 & nc & 17 & readout (AMC13)\\\hline
TX1/19 & tx4/6  &     & X1Y17 & 10G & 0x25 & nc & 18 & readout (AMC13)\\\hline
TX1/20 & tx4/7  &     & X1Y16 & 10G & 0x27 & nc & 19 & readout (AMC13)\\\hline
TX1/21 & tx4/8  & 113 & X1Y15 & 10G & 0x29 & nc & 20 & readout (AMC13)\\\hline
TX1/22 & tx4/9  &     & X1Y14 & 10G & 0x2b & nc & 21 & readout (AMC13)\\\hline
TX1/23 & tx4/10 &     & X1Y13 & 10G & 0x2d & nc & 22 & readout (AMC13)\\\hline
TX1/24 & tx4/11 &     & X1Y12 & 10G & 0x2f & nc & 23 & readout (AMC13)\\\hline
TX1/25 & tx5/0  & 112 & X1Y11 & 10G & 0x31 & nc & 24 & readout (AMC13)\\\hline
TX1/26 & tx5/1  &     & X1Y10 & 10G & 0x33 & nc & 25 & readout (AMC13)\\\hline
TX1/27 & tx5/2  &     & X1Y09 & 10G & 0x35 & nc & 26 & -\\\hline
TX1/28 & tx5/3  &     & X1Y08 & 10G & 0x37 & nc & 27 & -\\\hline
TX1/29 & tx5/4  & 111 & X1Y07 &  x  & 0x39 & nc & 28 & -\\\hline
TX1/30 & tx5/5  &     & X1Y06 &  x  & 0x3b & nc & 29 & -\\\hline
TX1/31 & tx5/6  &     & X1Y05 &  x  & 0x3d & nc & 30 & -\\\hline
TX1/32 & tx5/7  &     & X1Y04 &  x  & 0x3f & nc & 31 & -\\\hline
TX1/33 & tx5/8  & 110 & X1Y03 &  x  & 0x41 & nc & 32 & -\\\hline
TX1/34 & tx5/9  &     & X1Y02 &  x  & 0x43 & nc & 33 & -\\\hline
TX1/35 & tx5/10 &     & X1Y01 &  x  & 0x45 & nc & 34 & -\\\hline
TX1/36 & tx5/11 &     & X1Y00 &  x  & 0x47 & nc & 35 & -\\\hline
TX2/26 & tx2/1  &     & X0Y00 &  x  & 0x49 & nc & 36 & -\\\hline
TX2/25 & tx2/0  &     & X0Y01 &  x  & 0x4b & nc & 37 & -\\\hline
TX2/28 & tx2/3  &     & X0Y02 &  x  & 0x4d & nc & 38 & -\\\hline
TX2/27 & tx2/2  & 210 & X0Y03 &  x  & 0x4f & nc & 39 & -\\\hline
TX2/30 & tx2/5  &     & X0Y04 &  x  & 0x51 & nc & 40 & -\\\hline
TX2/29 & tx2/4  &     & X0Y05 &  x  & 0x53 & nc & 41 & -\\\hline
TX2/32 & tx2/7  &     & X0Y06 &  x  & 0x55 & nc & 42 & -\\\hline
TX2/31 & tx2/6  & 211 & X0Y07 &  x  & 0x57 & nc & 43 & -\\\hline
TX2/34 & tx2/8  &     & X0Y08 &  x  & 0x59 & nc & 44 & -\\\hline
TX2/33 & tx2/10 &     & X0Y09 &  x  & 0x5b & nc & 45 & -\\\hline
TX2/35 & tx2/9  &     & X0Y10 &  x  & 0x5d & nc & 46 & -\\\hline
TX2/36 & tx2/11 & 212 & X0Y11 &  x  & 0x5f & nc & 47 & -\\\hline
TX2/14 & tx1/1  &     & X0Y12 &  x  & 0x61 & nc & 48 & -\\\hline
TX2/13 & tx1/0  &     & X0Y13 &  x  & 0x63 & nc & 49 & -\\\hline
TX2/16 & tx1/3  &     & X0Y14 &  x  & 0x65 & nc & 50 & -\\\hline
TX2/15 & tx1/2  & 213 & X0Y15 &  x  & 0x67 & nc & 51 & -\\\hline
TX2/18 & tx1/5  &     & X0Y16 &  x  & 0x69 & nc & 52 & -\\\hline
TX2/17 & tx1/4  &     & X0Y17 &  x  & 0x6b & nc & 53 & -\\\hline
TX2/20 & tx1/7  &     & X0Y18 &  x  & 0x6d & nc & 54 & -\\\hline
TX2/19 & tx1/6  & 214 & X0Y19 &  x  & 0x6f & nc & 55 & -\\\hline
TX2/22 & tx1/9  &     & X0Y20 &  x  & 0x71 & nc & 56 & -\\\hline
TX2/21 & tx1/8  &     & X0Y21 &  x  & 0x73 & nc & 57 & -\\\hline
TX2/23 & tx1/10 &     & X0Y22 &  x  & 0x75 & nc & 58 & -\\\hline
TX2/24 & tx1/11 & 215 & X0Y23 &  x  & 0x77 & nc & 59 & -\\\hline
TX2/2  & tx0/1  &     & X0Y24 & 10G & 0x79 & nc & 60 & -\\\hline
TX2/1  & tx0/0  &     & X0Y25 & 10G & 0x7b & nc & 61 & -\\\hline
TX2/4  & tx0/3  &     & X0Y26 & 10G & 0x7d & nc & 62 & ZDC 10G output\\\hline
TX2/3  & tx0/2  & 216 & X0Y27 & 10G & 0x7f & nc & 63 & ZDC 10G output\\\hline
TX2/6  & tx0/5  &     & X0Y28 & 10G & 0x81 & nc & 64 & ZDC 10G output\\\hline
TX2/5  & tx0/4  &     & X0Y29 & 10G & 0x83 & nc & 65 & ZDC 10G output\\\hline
TX2/8  & tx0/7  &     & X0Y30 & 10G & 0x85 & nc & 66 & ZDC 10G output\\\hline
TX2/7  & tx0/6  & 217 & X0Y31 & 10G & 0x87 & nc & 67 & ZDC 10G output\\\hline
TX2/10 & tx0/9  &     & X0Y32 &  5G & 0x89 & nc & 68 & -\\\hline
TX2/9  & tx0/8  &     & X0Y33 &  5G & 0x8b & nc & 69 & -\\\hline
TX2/11 & tx0/10 &     & X0Y34 &  5G & 0x8d & nc & 70 & -\\\hline
TX2/12 & tx0/11 & 218 & X0Y35 &  5G & 0x8f & nc & 71 & -\\\hline
\end{longtable}

\clearpage
\subsection{Configuration of GTHs}\label{sec:app:app_a}

The FPGA on MP7 board receives and transmits data via GTH transceivers.\\
In Figure~\ref{fig:app:gth_conf} configuration of GTHs~\cite{GTHs} for Global Trigger is shown.

\begin{figure}[htb]
\centering
\includegraphics[width=15cm]{figures/gth_xc7v690t_ffg1927}
\caption{Configuration of GTHs}
\label{fig:app:gth_conf}
\end{figure}

\clearpage

\subsection{Configuration of optical input links}\label{sec:app:app_b}

Figure~\ref{fig:app:ugt_inputs} shows the configuration of optical links to Global Trigger.\\
Links 0..3 contains muon data from GMT, links 4..11 data from GCT and links 12..15 external conditions
from AMC502 boards.

\begin{figure}[htb]
\centering
\includegraphics[width=15cm]{figures/ugt_inputs}
\caption{Optical link inputs to Global Trigger}
\label{fig:app:ugt_inputs}
\end{figure}

\subsection{Configuration of links to AMC13 (readout)}\label{sec:app:app_c}

Figure~\ref{fig:app:ugt_outputs} shows the configuration of links from Global Trigger to AMC13 (readout).\\
Links 16..24 contains algo data (after GTL, after BX mask and after prescalers), link 25 contains several counter values.

\begin{figure}[htb]
\centering
\includegraphics[width=15cm]{figures/ugt_outputs}
\caption{Outputs from Global Trigger to AMC13}
\label{fig:app:ugt_outputs}
\end{figure}

\clearpage

\subsection{Optical patch panel}\label{sec:app:app_d}

Figure~\ref{fig:app:ugt_pp} shows the connections on Global Trigger patch panel for optical links.

\begin{figure}[htb]
\centering
\includegraphics[width=15cm]{figures/ugt_patchpanel}
\caption{Global Trigger patch panel for optical link}
\label{fig:app:ugt_pp}
\end{figure}

\subsection{Description of simulation, synthesis and hardware tests}\label{sec:app:app_e}

Workflow for simulation and synthesis of firmware is described in \href{\gitbranch/README.md}{\texttt{README}} file.\\\\
List of useful TDF routines and commands for hardware tests:
\begin{itemize}
\item Check crate status\\
\greybox{\$ tdf run crate\_status}
\item Enable TTC signals on AMC13 for all MP7 modules\\
\greybox{\$ tdf run ttc\_enable}
\item Check lock of BC0 and LHC clock\\
\greybox{\$ tdf unittest <module> default}
\item Reset module\\
\greybox{\$ tdf mp7butler reset <module> --clksrc external --clkcfg default-ext}
\item Load firmware to scansd card on all MP7 modules [and load it into FPGAs]\\
\greybox{\$ tdf run uploadfw\_gt <tar file path> [--rebootfpga]}
\item Load firmware from scansd card into FPGAs\\
\greybox{\$ tdf run loadfw\_gt <fw build nr> <nr modules>}
\item Compare hardware results with test vector pattern (for a certain firmware build)\\
\greybox{\$ tdf run multiboard\_function\_test -h}
\item Setup links (GTHs)\\
\greybox{\$ tdf mp7butler rxmgts <module> -e <links>}
\item Align links (GTHs)\\
\greybox{\$ tdf mp7butler rxalign <module> -e <links> [--to-bx <alignment point>]}
\item Check minipods\\
\greybox{\$ tdf mp7butler minipods <module>}
\item ... (other routines are available in /nfshome0/ugtdev/software/tdf/etc/routines)
\end{itemize}

\clearpage
